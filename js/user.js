var signupURL="http://media.nuestrodiario.com/MovilX/mobileOps2/user_registration.php";var signinURL="http://media.nuestrodiario.com/MovilX/mobileOps2/user_in.php";var signoutURL="http://media.nuestrodiario.com/MovilX/mobileOps2/user_out.php";var profileURL="http://media.nuestrodiario.com/MovilX/mobileOps2/get_profile.php";var updateURL="http://media.nuestrodiario.com/MovilX/mobileOps2/set_profile.php";var resetURL="http://media.nuestrodiario.com/MovilX/mobileOps2/passwd_recovery.php";var passwordURL="http://media.nuestrodiario.com/MovilX/mobileOps2/set_password.php";function failure(a){console.log(JSON.stringify(a));navigator.notification.alert("Ocurrió un problema, por favor intenta más tarde.",function(){},"Error","Aceptar");enable("#submit-button");$.mobile.loading("hide")}function signed_in(a){if(typeof window.sessionStorage.session=='undefined"'){a.preventDefault();$.mobile.changePage("index.html",{transition:"none"})}}function login(d,b,c,a){$.post(signinURL,{username:d,password:b},function(e){if(c){c(e)}if(e.items!=undefined){window.localStorage.username=d;window.sessionStorage.password=b;window.sessionStorage.session=e.items[0].session_id;$.mobile.changePage("editions.html")}else{console.log(JSON.stringify(e));var f="Ocurrió un error, intenta más tarde.";if(e.error!=undefined){f=e.error[0].text}navigator.notification.alert("Error: "+f,function(){},"Error","Aceptar");$.mobile.changePage("signin.html")}},"json").fail(function(f){failure(f)});return false}function autoLogin(b){var c=window.localStorage.username;var a=window.sessionStorage.password;if(typeof c!="undefined"&&typeof a!="undefined"){logout();$.mobile.loading("show",{text:"Iniciando sesión...",textVisible:true});login(c,a,function(){$.mobile.loading("hide")},function(d){failure(d)})}else{if(typeof b!="undefined"){$.mobile.changePage(b)}}}function signin(){var b=$("#sign-in-form");var c=$("#username",b).val();var a=$("#password",b).val();if(c!=""&&a!=""){disable("#submit-button");$.mobile.loading("show",{text:"Iniciando sesión...",textVisible:true});login(c,a,function(){$.mobile.loading("hide");enable("#submit-button")},function(d){failure(d)})}else{navigator.notification.alert("Debes ingresar tu usuario y password.",function(){},"Error","Aceptar")}enable("#submit-button");return true}function signup(){var f=$("#sign-up-form");disable("#submit-button");var g=$("#username",f).val();var d=$("#name",f).val();var e=$("#lastname",f).val();var c=$("#password",f).val();var b=$("#email",f).val();var a={username:g,name:d,lastname:e,password:c,email:b};$.post(signupURL,a,function(h){console.log(JSON.stringify(h));if(h.items!=undefined){navigator.notification.alert("Registro completado, bienvenido.",function(){},"Bienvenido","Aceptar");login(g,c)}else{navigator.notification.alert("Error al registrarse: "+h.error[0].text,function(){},"Error","Aceptar")}enable("#submit-button")},"json").fail(function(h){failure(h)});enable("#submit-button");return true}function profile(){var b=window.localStorage.username;var a=window.sessionStorage.session;if(b!=undefined){$.mobile.loading("show",{text:"Cargando...",textVisible:true});disable("#submit-button");$.post(profileURL,{username:b,session:a},function(d){$.mobile.loading("hide");if(d.items!=undefined){var c=d.items[0];$("#username").val(c.username);$("#email").val(c.email);$("#name").val(c.name);$("#lastname").val(c.lastname)}else{navigator.notification.alert("Error: "+d.error[0].text,function(){},"Error","Aceptar")}enable("#submit-button")},"json").fail(function(c){failure(c)})}}function updateProfile(){var f=window.localStorage.username;var e=window.sessionStorage.session;if(f!=undefined){$.mobile.loading("show",{text:"Actualizando...",textVisible:true});disable("#submit-button");var f=$("#username").val();var c=$("#email").val();var b=$("#name").val();var d=$("#lastname").val();var a={session:e,username:f,name:b,lastname:d,email:c};$.post(updateURL,a,function(g){$.mobile.loading("hide");enable("#submit-button");navigator.notification.alert("Cuenta actualizada con éxito.",function(){},"Alerta","Aceptar")},"json").fail(function(g){failure(g)})}}function logout(a){var b=window.localStorage.username;$.post(signoutURL,{username:b},function(c){if(c.items[0].closed=="OK"){window.localStorage.removeItem("username");window.sessionStorage.removeItem("password");window.sessionStorage.removeItem("session");if(typeof a=="undefined"){$.mobile.changePage("index.html")}}else{if(typeof a=="undefined"){navigator.notification.alert("Error:"+c.error[0].text,function(){},"Error","Aceptar")}}},"json").fail(function(c){failure(c)})}function passwordReset(){var a=$("#login").val();if(a!=""){$.mobile.loading("show",{text:"Procesando...",textVisible:true});disable("#reset-button");$.post(resetURL,{email_or_account:a,generate:1},function(b){if(b.items!=undefined&&b.items.email_sent=="OK"){window.sessionStorage.removeItem("password");window.sessionStorage.removeItem("session");$("#login-collapse").trigger("expand");navigator.notification.alert("Se ha enviado una nueva contraseña a: "+b.items.account_email,function(){},"Atención","Aceptar")}else{navigator.notification.alert(b.error[0].text,function(){},"Error","Aceptar")}$.mobile.loading("hide");enable("#reset-button")},"json").fail(function(b){failure(b)})}}function passwordChange(){var d=window.sessionStorage.session;var c=$("#password").val();var b=$("#confirm").val();if(c!=""){if(c==b){$.mobile.loading("show",{text:"Actualizando...",textVisible:true});disable("#password-change-button");var a={session:d,passw:c};$.post(passwordURL,a,function(e){console.log(JSON.stringify(e));if(typeof e.error=="undefined"){window.sessionStorage.password=c;$("#profile-collapse").trigger("expand");navigator.notification.alert("Contraseña cambiada con éxito.",function(){},"Alerta","Aceptar")}else{navigator.notification.alert(e.error[0].text,function(){},"Error","Aceptar")}$.mobile.loading("hide");enable("#password-change-button")},"json").fail(function(f){failure(f)})}else{navigator.notification.alert("Las contraseñas no coinciden.",function(){},"Error","Aceptar")}}else{navigator.notification.alert("Tu contraseña no puede estar en blanco.",function(){},"Error","Aceptar")}};