var editionsURL="http://media.nuestrodiario.com/MovilX/mobileOps2/geteditions.php";var sectionsURL="http://media.nuestrodiario.com/MovilX/mobileOps2/getsections.php";var pagesURL="http://media.nuestrodiario.com/MovilX/mobileOps2/getpages_section.php";var mediaURL="http://media.nuestrodiario.com/MovilX/mobileOps2/getmedia_page.php";var tabsURL="http://media.nuestrodiario.com/MovilX/mobileOps2/gettabs.php";function failure(a){console.log(JSON.stringify(a));navigator.notification.alert("Ocurri칩 un problema, por favor intenta m치s tarde.",function(){},"Error","Aceptar");enable("#submit-button");$.mobile.loading("hide")}function getEditionCover(a,b){$(a).load("")}function getEditionURL(a){var b="http://media.nuestrodiario.com/nuestrodiario/pages/edicion/";return b+slashDate(new Date(a))+"/edicion_nacional/1.jpg"}function getSectionURL(b){var a="http://media.nuestrodiario.com/nuestrodiario/pages/edicion/";return a+b.slashDate+"/"+b.title.toSnake()+"/1.jpg"}function getCurrentSectionURL(){var a=parseInt(window.sessionStorage.currentSection);var b=JSON.parse(window.sessionStorage.sections);return getSectionURL(b[a])}function searchEditions(){var d=$("#start-date").val();var a=$("#end-date").val();if(d==""||a==""){navigator.notification.alert("Debes ingresar las fechas a buscar.",function(){},"Error","Aceptar")}else{var b=parseDate(d);var c=parseDate(a);$.mobile.loading("show",{text:"Buscando ediciones...",textVisible:true});disable("#submit-button");disable(".ui-input-datebox");getEditions(b,c,function(){$.mobile.loading("hide");enable("#submit-button");enable(".ui-input-datebox")},function(f){failure(f)})}}function getEditions(e,a,d,c){if(typeof e=="undefined"){e=lastWeek()}else{e=e}e=formatDate(e);if(typeof a=="undefined"){a=today()}else{a=a}a=formatDate(a);var b={s_date:e,e_date:a};$.post(editionsURL,b,function(f){if(typeof d!="undefined"){d()}if(f.items==null){$("#editions-page #editions").html("<center><h4>No se encontraron resultados.</h4></center>")}else{$("#editions-page #editions").html("");$.each(f.items,function(h,i){var g=i.fixed_slash_date;console.log(getEditionURL(g));$("#editions-page #editions").append('<dt><ul data-role="listview" data-inset="true" class="loc-card"><li class="loc-image"><div><a onclick="getSections('+formatDate(new Date(g))+');"><img src="'+getEditionURL(g)+'"/></div></li></ul></dt>')});$("#editions-page #editions ul").listview()}},"json").fail(c)}function getSections(b){$.mobile.loading("show",{text:"Cargando edicion...",textVisible:true});var a={e_date:b};var c=[];$.post(sectionsURL,a,function(e){var d=e.items;var f;if(d!=null){$.each(d,function(g,h){f={};f.id=h.supplement_id;f.title=h.cat_supplement_type_name;f.weight=h.weight;f.date=parseDashedDate(h.edition_publication_date);f.slashDate=slashDate(f.date);f.prettyDate=prettyDate(f.date);f.pages=h.pages_amount;c.push(f)});c.sort(sortByWeight)}window.sessionStorage.sections=JSON.stringify(c);window.sessionStorage.currentSection=0;$.mobile.loading("hide");$.mobile.changePage("edition_even.html")},"json").fail(function(d){failure(d)})}function loadSections(a){if(typeof a=="undefined"){a=JSON.parse(window.sessionStorage.sections)}$.each(a,function(b,c){$("#sections").append('<dt><ul id="'+c.id+'" data-role="listview" data-inset="true" class="loc-card"><li class="loc-image"><div><a onclick="loadSection('+b+');"><img src="'+getSectionURL(c)+'"/></div></li></ul></dt>')});$("#sections ul").listview()}function loadSection(b,c){var a=getSectionURL(c);$(b+" #loader").show();window.loadImage(a,function(d){if(d.type==="error"){console.log("Error loading section image."+a)}else{$(b+" #section").attr("src",a);$(b+" #loader").hide()}},{});$(b).one("swipeleft",nextSection);$(b).one("swiperight",prevSection)}function nextSection(){var a=parseInt(window.sessionStorage.currentSection)+1;var c=JSON.parse(window.sessionStorage.sections);if(a<c.length){window.sessionStorage.currentSection=a;var b=a%2==0?"even":"odd";$.mobile.changePage("edition_"+b+".html")}}function prevSection(){var a=parseInt(window.sessionStorage.currentSection);if(a>0){a--;window.sessionStorage.currentSection=a;var b=a%2==0?"even":"odd";$.mobile.changePage("edition_"+b+".html",{reverse:true})}else{}}function showSectionOld(a){console.log(a);var b=window.sessionStorage.currentSection;var d=b%2==0?"even":"odd";var c=a%2==0?"even":"odd";window.sessionStorage.currentSection=a;if(d!=c){$.mobile.changePage("edition_"+c+".html")}else{var f=JSON.parse(window.sessionStorage.sections);var e=f[a];$("#edition-"+c+"-page #edition-title").html(e.title);loadSection("#edition-"+c+"-page",e);sectionsPanel(f);$("#sections-panel").panel("close")}}function showSection(a){console.log(a);var b=window.sessionStorage.currentSection;window.sessionStorage.currentSection=a;$.mobile.changePage("edition_even.html")}function sectionsPanel(e){var c=parseInt(window.sessionStorage.currentSection);if(typeof e=="undefined"){e=JSON.parse(window.sessionStorage.sections)}var d=e[c];var b=$("#sections-panel ul").html("");var a="";$.each(e,function(f,g){if(f==c){a='class="ui-btn-active"'}else{a=""}b.append("<li "+a+'><a onclick="showSection('+f+');" data-role="button" data-iconpos="right">'+g.title+'<span class="ui-li-count">'+g.pages+"</span></a></li>")});b.listview("refresh")}function sectionsPage(f){var b=parseInt(window.sessionStorage.currentSection);if(typeof f=="undefined"){f=JSON.parse(window.sessionStorage.sections)}var e=f[b];var a={};a.Metro="metro";a["Regional Sur"]="sur";a["Regional Norte"]="norte";a["Regional Oriente"]="oriente";a["Regional Centro"]="centro_occidente";a["Regional SurOccidente"]="sur_occidente";a["Regional SurOriente"]="sur_oriente";a["Regional Xela"]="xela";a["Regional Occidente"]="occidente";a["Regional Frontera"]="frontera";a["Regional Verapaz"]="verapaz";a["Edicion Nacional"]="nacional";var d;var c=$("#editions-grid");c.html("");$.each(f,function(g,h){d=a[h.title];if(typeof d!="undefined"){if(g==b){d+="_alt"}c.append('<a href="#" onclick="showSection('+g+');"><img src="images/editions/'+d+'.png" alt="'+h.title+'" width="24%"></a>')}if(g==7){}else{if(g==10){c.append('<img src="images/editions/white1.png" width="24%">')}else{if(g==11){c.append('<img src="images/editions/blue1.png" width="24%">');c.append('<img src="images/editions/white1.png" width="24%">')}}}});c.append('<a href="sections_menu.html"><img src="images/editions/secciones.png" width="23%"></a>')}function getTabs(d){if(typeof d=="undefined"){var b=window.sessionStorage.currentSection;var e=JSON.parse(window.sessionStorage.sections);d=e[b]}var a={sup_id:d.id};var c=[];$.post(tabsURL,a,function(g){var f=g.items;var h;if(f!=null){$.each(f,function(i,j){h={};h.id=j.cat_tab_detail_id;h.title=j.cat_tab_detail_name;h.weight=j.weight;h.page_number=j.page_number;h.page_id=j.page_id;c.push(h)});c.sort(sortByWeight);window.sessionStorage.tabs=JSON.stringify(c)}else{window.sessionStorage.tabs=JSON.stringify([]);console.log(JSON.stringify(g))}},"json").fail(function(f){failure(f)})}function tabsPanel(b,e){var d=parseInt(window.sessionStorage.currentPage);if(typeof e=="undefined"){e=JSON.parse(window.sessionStorage.tabs)}var c=$("#tabs-panel ul").html("");var a="";if(e.length==0){$.each(b,function(f,g){if(f==d){a='class="ui-btn-active"'}else{a=""}c.append('<li id="tab-'+f+'"'+a+'><a onclick="showPage('+f+');" data-role="button" data-iconpos="right"> P치gina #'+g.number+"</a></li>")})}else{$.each(e,function(f,g){if(f==d){a='class="ui-btn-active"'}else{a=""}c.append('<li id="tab-'+f+'"'+a+'><a onclick="showPage('+(g.page_number-1)+');" data-role="button" data-iconpos="right">'+g.title+"</a></li>")})}c.listview("refresh")}function tabsPage(b,d){var c=parseInt(window.sessionStorage.currentPage);if(typeof d=="undefined"){d=JSON.parse(window.sessionStorage.tabs)}var a={};a.Pais="pais";a.Opinion="opinion";a.Mundo="mundo";a.Deporte="deportes";a.Estrellas="estrellas";a.Impacto="impacto";a.Familia="familia";a["Negocios y Servicios"]="negocios";var f;var e=$("#sections-grid");e.html("");if(d.length>0){$.each(d,function(g,h){f=a[h.title];if(typeof f!="undefined"){if(g==c){f+="_alt"}e.append('<a href="#" onclick="showTab('+(h.page_number-1)+');"><img src="images/sections/'+f+'.png" alt="'+h.title+'" width="23%"></a>')}if(g==5){e.append('<img src="images/sections/white1.png" width="23%">');e.append('<img src="images/sections/blue1.png" width="23%">')}else{if(g==6){e.append('<img src="images/sections/white1.png" width="23%">');e.append('<img src="images/sections/blue1.png" width="23%">');e.append('<img src="images/sections/white1.png" width="23%">');e.append('<img src="images/sections/white1.png" width="23%">');e.append('<img src="images/sections/blue1.png" width="23%">');e.append('<img src="images/sections/white1.png" width="23%">')}}})}e.append('<a href="editions_menu.html"><img src="images/sections/regionales.png" width="23%"></a>')}function getPages(e){$.mobile.loading("show",{text:"Cargando secci칩n...",textVisible:true});var c=window.sessionStorage.currentSection;var f=JSON.parse(window.sessionStorage.sections);var d=f[c];var b={sup_id:d.id};var a=[];$.post(pagesURL,b,function(h){var g=h.items;var i;if(g!=null){$.each(g,function(j,k){i={};i.id=k.page_id;i.number=k.page_number;i.base_url=k.base_url+k.year+"/"+k.month+"/"+k.day+"/"+k.folder+"/";i.small=i.base_url+k.small;i.medium=i.base_url+k.medium;i.large=i.base_url+k.large;a.push(i)});$.mobile.loading("hide");window.sessionStorage.pages=JSON.stringify(a);window.sessionStorage.currentPage=0;if(e){e()}}else{console.log(h.error.text)}},"json").fail(function(g){failure(g)})}function loadPages(a){$("#section-page #pages").html();$.each(a,function(b,c){$("#section-page #pages").append('<dt style="display:none"><ul data-role="listview" data-inset="true" class="loc-card"><li class="loc-image"><div><a href="zoom.html"><img src="'+c.medium+'" alt="Page #'+c.number+'"/></a></div></li></ul></dt>')});$("#section-page #pages ul").listview();$(document).off("swipeleft").on("swipeleft","#section-page",nextPage);$(document).off("swiperight").on("swiperight","#section-page",prevPage)}function nextPage(){var b=parseInt(window.sessionStorage.currentPage);var a=JSON.parse(window.sessionStorage.pages);if(b+1<a.length){showPage(b+1)}}function prevPage(){var a=parseInt(window.sessionStorage.currentPage);if(a>0){showPage(a-1)}else{}}function showPage(b,a){if(typeof b=="undefined"){b=0}if(typeof a=="undefined"){a=JSON.parse(window.sessionStorage.pages)}window.sessionStorage.currentPage=b;$("#section-page #subtitle").html("P&aacute;gina #"+(b+1)+"/"+a.length);$("#section-page #pages dt.current").hide().toggleClass("current");$("#section-page #pages dt:nth-child("+(b+1)+")").show().toggleClass("current");$("#tabs-panel").panel("close");$("#tabs-panel ul .ui-btn-active").removeClass("ui-btn-active");$("#tabs-panel ul #tab-"+b).addClass("ui-btn-active");getMedia();$("html,body").animate({scrollTop:0},0)}function showTab(a){window.sessionStorage.currentPage=a;$.mobile.changePage("pages.html")}function zoomPage(b){$("#zoom-page #page").attr("src",b.medium);window.loadImage(b.large,function(e){if(e.type==="error"){console.log("Error loading image "+b.large)}else{console.log("large image loading completed.");$("#zoom-page #page").attr("src",b.large)}},{});$("#zoom-page #subtitle").html("P&aacute;gina #"+b.number);var a=parseInt(window.sessionStorage.currentSection);var d=JSON.parse(window.sessionStorage.sections);var c=d[a];$("#zoom-page #title").html(c.title)}function zoomNext(){var b=parseInt(window.sessionStorage.currentSection)+1;var a=JSON.parse(window.sessionStorage.pages);window.sessionStorage.currentSection=b;if(b+1<a.length){b++;zoomPage(a[b])}}function zoomLast(){var b=parseInt(window.sessionStorage.currentSection);var a=JSON.parse(window.sessionStorage.pages);window.sessionStorage.currentSection=b;if(b>0){b--;zoomPage(a[b])}}function getMedia(e){if(typeof e=="undefined"){var c=parseInt(window.sessionStorage.currentPage);var a=JSON.parse(window.sessionStorage.pages);e=a[c]}var b={page_id:e.id};var d=[];$.post(mediaURL,b,function(g){var f=g.items;if(f!=null){$.each(f,function(h,i){media={};media.id=i.tag_id;media.url=i.tag_url;media.title=i.tag_title;media.description=i.tag_text;media.type=i.tipo;d.push(media)});$("#section-page #media-btn").show();mediaPanel(d);window.sessionStorage.media=JSON.stringify(d);window.sessionStorage.currentMedia=0}else{$("#section-page #media-btn").hide()}},"json").fail(function(f){failure(f)})}function mediaPanel(b){if(typeof b=="undefined"){b=JSON.parse(window.sessionStorage.media)}var c;var a=$("#media-panel ul").html("");$.each(b,function(d,e){c=e.title||e.type;a.append('<li><a onclick="showMedia('+d+');" data-role="button" data-iconpos="right">'+c+"</a></li>")});a.listview("refresh")}function showMedia(a){var b=JSON.parse(window.sessionStorage.media);var c=b[a];window.sessionStorage.currentMedia=a;if(c.type="video"){$.mobile.changePage("video.html")}else{$.mobile.changePage("audio.html")}};